#!/bin/bash

JSON commands new

JSON options new

JSON options put "-h" "_help"
JSON options put "-r" "_recursive"

_help() {
    JSON help_info new
    JSON help_info put "_help" "Muestra la ayuda."
    JSON help_info put "_recursive" "Copia recursiva de carpetas."
    shelp commands options help_info "cp"
    exit 0
}

_p1=$1
_p2=$2
_p3=$3
_p4=$4
_p5=$5
_recursive() {

    if [ ! -d "$_p3" ]; then
        sconsole -e "( $_p3 ), is not a folder, try again with out -r"
        exit 0
    fi

    sconsole -e "TODO: operacion no implementada"
    exit 0
}

export_module commands options

dir_from="$2"
dir_to="$3"

if [ -z "$2" ]; then
    sconsole -e "Se requiere la direccion del archibo"
    exit 0
fi

if [ -d "$2" ]; then
    sconsole -e "( $2 ), is a folder, try again with -r"
    exit 0
fi

if [ ! -f "$2" ]; then
    sconsole -e "Archivo no existe ( $2 )"
fi

if [ -z "$3" ]; then
    # sconsole -e "Se requiere la direccion de destino"
    dir_to="/home/$USER/$dir_from"
    # exit 0
fi

name_from=$(basename $dir_from)
name_to=$(basename $dir_to)

path_final="/$name_from"

if [ ! -z "$name_to" ]; then
    path_final="$dir_to"
fi

if [[ ! $path_final =~ ^/ ]]; then
    path_final="/home/$USER/$dir_from"
fi

sconsole -w "$REPO_PATH$path_final"

curl --request POST "$REPO_UPLOAD_PATH" \
    -F "$path_final"=@"$dir_from"
